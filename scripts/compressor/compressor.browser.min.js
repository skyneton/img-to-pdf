function Compressor(){"use strict";if(void 0===new.target)throw new Error("Constructor must be called with new.");let e,t;const s=[];let a=0;this.start=((t,r)=>{if(void 0===t||void 0===r)throw new Error("옵션값을 입력해주세요");if(void 0===r.quality&&(r.quality=1),!e||Object.keys(s).length>=a)o(t,r);else{const a=s.length;s[a]=r,e.postMessage({file:t,return:a,options:{scale:r.scale,quality:r.quality}})}});const o=(e,t)=>{let s,o,i,c={};f(e)?URL?(t.quality<=0&&h(new Error("퀄리티는 0 초과의 수여야 합니다."),t),g(e)&&(s=e.split(",")[0].split(";")[0].replaceAll("data:",""),c.size=atob(e.split(",")[1]).length),(p(e)||u(e))&&(s=e.type,c.size=e.size),void 0===s&&(s="image/jpeg"),o=e,(p(e)||u(e))&&(o=URL.createObjectURL(e),i=!0),c.size||fetch(e).then(e=>e.blob()).then(e=>{c.size=e.size}),a++,t.quality>=1?p(e)?l(e,t,e,s,c,o,i):g(e)?l(e,t,new Blob([r(atob(e.split(",")[1]))],s),s,c,o,i):d(e)&&fetch(e).then(e=>e.blob()).then(a=>{l(e,t,a,s,c,o,i)}):n(e,t,s,c,o,i)):h(new Error("지원하지 않는 브라우저입니다."),t):h(new Error("첫번째 파라미터는 File/Blob/URL/Base64(Image) 여야 합니다."),t)},r=e=>{const t=new Uint8Array(e.length);for(let s=0;s<e.length;s++)t[s]=e.charCodeAt(s);return t},n=(e,t,s,o,r,n)=>{const l=new Image;l.onload=(()=>{i(e,t,l,s,o,r,n)}),l.onerror=(()=>{a--,h(new Error("이미지 로드 실패"),t)}),l.src=r},i=(e,t,s,a,o,r,n)=>{const i=document.createElement("canvas"),c=i.getContext("2d"),h=t.scale||(t.quality+.2<.7?.7:Math.min(1,t.quality+.2));let f=s.naturalWidth,u=s.naturalHeight;h>=1?(f=Math.floor(f/h),u=Math.floor(u/h)):(f=Math.floor(f*h),u=Math.floor(u*h)),i.width=f,i.height=u;function p(s){l(e,t,s,a,o,r,n)}c.fillStyle="transparent",c.fillRect(0,0,f,u),c.save(),c.translate(f/2,u/2),c.drawImage(s,-f/2,-u/2,f,u),c.restore(),i.toBlob?i.toBlob(p,a,t.quality):p(i.toDataURL(a,t.quality))},l=(e,t,s,o,r,n,i)=>{if(i&&d(n)&&URL.revokeObjectURL(n),s){if(!r.size||s.size>r.size)c(e,o).then(e=>{s=e});else if(u(e)){const t=new Date;s.lastModified=t.getTime(),s.lastModifiedDate=t,s.name=e.name}}else s=e;a--,t.success&&t.success(s)},c=(e,t)=>new Promise(s=>{u(e)?s(new Blob(e,{type:t})):g(e)?s(new Blob([r(atob(e.split(",")[1]))],{type:t})):d(e)?fetch(e).then(e=>e.blob()).then(e=>s(e)):s(e)}),h=(e,t,a)=>{if(null!=a&&null!=a&&delete s[a],!t.error)throw e;t.error(this,e)},f=e=>"undefined"!=typeof Blob&&(u(e)||p(e)||d(e)||g(e)),u=e=>e instanceof File,p=e=>e instanceof Blob,d=e=>"string"==typeof e&&e.startsWith("blob:"),g=e=>"string"==typeof e&&e.startsWith("data:image"),b=e=>{const t=e.data,a=s[t.return];if(a)switch(t.type){case"success":a.success&&(a.success(t.result),delete s[t.return]);break;case"error":h(t.result,a,t.return)}},w=()=>{self.addEventListener("message",s=>{const a=s.data;e(a.file).then(t(a))});const e=e=>new Promise(t=>{"string"==typeof e&&e.startsWith("data:image")?t(new Blob(e.split(",")[1],{type:file.split(",")[0].split(";")[0].replaceAll("data:","")})):"string"==typeof e&&e.startsWith("blob:")?fetch(e).then(e=>e.blob()).then(e=>t(e)):t(e)}),t=e=>t=>{createImageBitmap(t).then(s(e,t)).catch(t=>{self.postMessage({type:"error",result:t,return:e.return})})},s=(e,t)=>s=>{const a=new OffscreenCanvas(s.width,s.height),o=a.getContext("2d"),r=e.options.scale||(e.options.quality+.2<.7?.7:Math.min(1,e.options.quality+.2));let n=s.width,i=s.height;r>=1?(n=Math.floor(n/r),i=Math.floor(i/r)):(n=Math.floor(n*r),i=Math.floor(i*r));o.fillStyle="transparent",o.fillRect(0,0,n,i),o.save(),o.translate(n/2,i/2),o.drawImage(s,-n/2,-i/2,n,i),o.restore(),a.convertToBlob({quality:e.options.quality,type:"image/jpeg"}).then(s=>{if(s.size>t.size&&(s=t),e.file instanceof File){const t=new Date;s.lastModified=t.getTime(),s.name=e.file.name}self.postMessage({type:"success",result:s,return:e.return})})}};createImageBitmap&&Worker&&OffscreenCanvas&&location.protocol.startsWith("http")&&(t=URL.createObjectURL(new Blob([`(${w.toString()})()`])),(e=new Worker(t)).addEventListener("message",b))}