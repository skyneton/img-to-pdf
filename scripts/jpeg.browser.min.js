function JPEG(){"use strict";if(void 0===new.target)throw new Error("Constructor must be called with new.");let e,t;const r=[];let s=0;this.start=((t,o)=>{if(void 0!==t&&void 0!==o||a(new Error("옵션값을 입력해주세요"),o),!t instanceof File&&!t instanceof Blob&&a(new Error("파일은 Blob나 File 형태여야 합니다."),o),s>120&&(!e||Object.keys(r).length>120)){const a=setInterval(()=>{if(s<=120||!e&&Object.keys(r).length<=120){if(!e||s<=Object.keys(r).length)n(t,o);else{const s=r.length;r[s]=o,e.postMessage({file:t,return:s})}clearInterval(a)}},1e3)}else if(!e||s<=Object.keys(r).length)n(t,o);else{const s=r.length;r[s]=o,e.postMessage({file:t,return:s})}});const n=(e,t)=>{s++;const r=new Image;r.onload=(()=>{o(r,t)}),r.onerror=(()=>{s--,a(new Error("이미지 로드 실패"),t)}),r.src=URL.createObjectURL(e)},o=(e,t)=>{const r=document.createElement("canvas"),s=r.getContext("2d"),n=e.naturalWidth,o=e.naturalHeight;function a(r){_number--,URL.revokeObjectURL(e.src),e.remove(),"string"==typeof r&&(r=new Blob(r.split(",")[1],"image/jpeg")),t.success&&t.success(r)}r.width=n,r.height=o,s.fillStyle="white",s.fillRect(0,0,n,o),s.save(),s.translate(n/2,o/2),s.drawImage(e,-n/2,-o/2,n,o),s.restore(),r.toBlob?r.toBlob(a,"image/jpeg"):a(r.toDataURL("image/jpeg")),r.remove()},a=(e,t,s)=>{if(null!=s&&null!=s&&delete r[s],!t.error)throw e;t.error(this,e)},l=e=>{const t=e.data,s=r[t.return];if(s)switch(t.type){case"success":s.success&&(s.success(t.result),delete r[t.return]);break;case"error":a(t.result,s,t.return)}},c=()=>{self.addEventListener("message",t=>{const r=t.data;e(r)});const e=e=>{createImageBitmap(e.file).then(t(e)).catch(t=>{self.postMessage({type:"error",result:t,return:e.return})})},t=e=>t=>{const r=new OffscreenCanvas(t.width,t.height),s=r.getContext("2d"),n=t.width,o=t.height;s.fillStyle="white",s.fillRect(0,0,n,o),s.save(),s.translate(n/2,o/2),s.drawImage(t,-n/2,-o/2,n,o),s.restore(),r.convertToBlob({type:"image/jpeg"}).then(t=>{self.postMessage({type:"success",result:t,return:e.return})})}};createImageBitmap&&Worker&&OffscreenCanvas&&(t=URL.createObjectURL(new Blob([`(${c.toString()})()`])),(e=new Worker(t)).addEventListener("message",l))}